<?xml version="1.0" encoding="utf-8"?>
<odoo>

<record id="ia_crm_lost_reason_inherit" model="ir.ui.view">
        <field name="name">ia.crm.lost.reason.wizard.inherit</field>
        <field name="model">crm.lead.lost</field>
        <field name="inherit_id" ref="crm.crm_lead_lost_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='lost_reason_id']" position="replace">
              <field name="lost_reason_id" options="{'no_create_edit': True}" required="1"/>
            </xpath>
        </field>
</record>

<record id="ia_crm_inherit" model="ir.ui.view">
        <field name="name">ia.crm.lead.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_deadline']" position="before">
              <field name="quote_ref"/>
              <field name="is_lost" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='source_id']" position="replace">
              <field name="source_id" required="1"/>
            </xpath>

            <xpath expr="//button[@name='%(crm.crm_lead_lost_action)d']" position="replace">
              <button name="%(crm.crm_lead_lost_action)d" string="Mark Lost" type="action" class="oe_highlight" context="{'default_lead_id': active_id}"
                            attrs="{'invisible': ['|', ('type', '=', 'lead'),('is_lost', '=', True),('probability', '&lt;', 100)]}"/>
            </xpath>
            <xpath expr="//form/sheet/widget[1]" position="after">
              <widget name="web_ribbon" title="Lost" bg_color="bg-danger" attrs="{'invisible': [('is_lost', '!=', True)]}"/>
            </xpath>
        </field>
        
</record>

<record id="ia_crm_lead_tree_inherit" model="ir.ui.view">
        <field name="name">ia.crm.lead.tree_inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='team_id']" position="after">
              <field name="lost_reason"/>
            </xpath>
        </field>
</record>

<!-- [WTA] Hide Quotations Button for Rental Opportunities (#6856) -->
<record id="ia_crm_oppr_inherit" model="ir.ui.view">
        <field name="name">ia.crm.oppr.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="sale_crm.crm_case_form_view_oppor"/>
        <field name="arch" type="xml">

            <xpath expr="//button[@name='action_sale_quotations_new']" position="replace">
              <button string="New Quotation" name="action_sale_quotations_new" type="object" class="oe_highlight" attrs="{'invisible': ['|','|','|','|', ('sale_amount_total', '&gt;', 0), ('quotation_count', '&gt;', 0), ('rental_quotation_count', '&gt;', 0), ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False)]}"/>
            </xpath>

            <xpath expr="//button[@name='action_view_sale_quotation']" position="replace">
              <button class="oe_stat_button" type="object" name="action_view_sale_quotation" icon="fa-pencil-square-o" attrs="{'invisible': ['|','|', ('rental_quotation_count', '&gt;', 0), ('quotation_count', '=', 0), ('type', '=', 'lead')]}">
                  <field name="quotation_count" widget="statinfo" string="Quotations"/>
              </button>
            </xpath>

           <xpath expr="//button[@name='action_view_sale_order']" position="replace">
            <button class="oe_stat_button" type="object" attrs="{'invisible': ['|','|', ('rental_order_count', '&gt;', 0), ('sale_order_count', '=', 0), ('type', '=', 'lead')]}"
                        name="action_view_sale_order" icon="fa-usd">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value"><field name="sale_amount_total" widget="monetary" options="{'currency_field': 'company_currency'}"/></span>
                            <span class="o_stat_text"> Orders</span>
                            <field name="sale_order_count" invisible="1"/>
                        </div>
                    </button>
               </xpath>

        </field>
</record>

<!-- [WTA] Hide Quotations Button for Rental Opportunities (#6856) -->
<record id="ia_crm_oppr_rent_inherit" model="ir.ui.view">
        <field name="name">ia.crm.oppr.rent.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="sale_renting_crm.crm_case_form_view_oppor"/>
        <field name="arch" type="xml">

            <xpath expr="//button[@name='action_rental_quotations_new']" position="replace">
              <button string="New Rental" name="action_rental_quotations_new" type="object" class="oe_highlight" attrs="{'invisible': ['|','|','|','|', ('sale_amount_total', '&gt;', 0), ('quotation_count', '&gt;', 0), ('rental_quotation_count', '&gt;', 0), ('type', '=', 'lead'), '&amp;', ('probability', '=', 0), ('active', '=', False)]}"/>
            </xpath>

        </field>
</record>


<record id="ia_crm_quick_create_inherit" model="ir.ui.view">
        <field name="name">ia.crm.lead.quick.create.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.quick_create_opportunity_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='phone']" position="after">
              <field name="source_id" required="1"/>
            </xpath>
        </field>
</record>

<!-- Kanban-->
<record id="ia_crm_kanban_inherit" model="ir.ui.view">
        <field name="name">ia_crm_kanban_inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
        <field name="arch" type="xml">
          <xpath expr="//templates/t[1]/div[1]/div[2]/div[1]" position="after">
            <div>
              <field name="quote_ref"/>
            </div>
          </xpath>
        </field>
</record>

<record id="ia_crm_stage_inherit" model="ir.ui.view">
        <field name="name">ia.crm.stage.inherit</field>
        <field name="model">crm.stage</field>
        <field name="inherit_id" ref="crm.crm_stage_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='is_won']" position="after">
              <field name="is_lost"/>
            </xpath>
        </field>
</record>

<record id="ia_crm_filter_inherit" model="ir.ui.view">
        <field name="name">ia.crm.filter.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
        <field name="arch" type="xml">
            <filter name="inactive" position="before">
                    <filter string="Current Month" name="iacurrentmonth"
domain="[
('create_date','&gt;=',(context_today()).strftime('%Y-%m-01')),
('create_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%Y-%m-01'))
]" />
                </filter>
		<field name="name" position="after">
                	<field name="quote_ref"/>
            	</field>
        </field>
</record>

<!-- Partner Form -->
<record id="ia_partner_form_inherit" model="ir.ui.view">
        <field name="name">ia_partner_form_inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="account.view_partner_property_form"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='accounting_entries']" position="after">
              <group>
                <field name="has_account"/>
              </group>
            </xpath>
        </field>
</record>


    <record id="quick_create_opportunity_form_inherit" model="ir.ui.view">
        <field name="name">crm.lead.form.quick_create.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.quick_create_opportunity_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit': True, 'no_open': True}</attribute>
            </xpath>
        </field>
    </record>

</odoo>
